# Goal
- チャットカードで画像を選択しても即送信せず、**入力エリアにプレビューを表示**。ユーザーが送信ボタンを押したときに、テキストと画像を**同時に送信**できるようにする

# UI仕様（UI Spec）
-デザインは添付画像を参照
- 画像選択後のプレビュー表示（入力エリア上部にスタック表示）
  - サムネイル（正方形 72px, `rounded-lg`, `object-cover`）
  - ファイル名/サイズ（`text-xs text-muted-foreground truncate`）
  - 削除ボタン（×, `absolute top-1 right-1`）
  - 全体ラッパ: `group relative flex items-center gap-2 p-2 bg-muted/40 rounded-xl`
- 送信ボタンの活性条件
  - 条件: テキストがある **または** 添付画像が1枚以上
  - 無効時: `opacity-50 cursor-not-allowed`
- 進行状態
  - 画像処理中（プレビュー生成/バリデーション中）はサムネイル枠にスケルトン（`animate-pulse`）
  - 送信中は送信ボタンをスピナー表示に切替（`aria-busy="true"`）
- アクセシビリティ
  - 各プレビューは `role="listitem"`、一覧は `role="list"`

# 挙動仕様（Behavior）
- 選択（`onChange`）
  - 受理する MIME: `image/png`, `image/jpeg`, `image/webp`（アニメGIFは除外）
  - 1枚あたり最大 10MB、合計最大 3 枚（超過は拒否しトースト表示）
  - 受理後、**即送信しない**。メモリ上でプレビュー用 URL を生成し、プレビューリストに追加
- 編集
  - プレビュー上の × を押下で該当画像のみ削除（テキストは維持）
  - すべて削除時、送信ボタンはテキスト未入力なら無効化
- 送信
  - 送信時、プレビュー内は読み取り専用（削除不可）にロック
  - マルチパートで `text`, `images[]` を同一メッセージとして送信
  - 成功: チャットタイムラインにユーザーメッセージ1件として表示（画像はインラインギャラリー）
  - 成功後に入力欄とプレビューはクリア
- 異常系
  - バリデーションNG（種類/サイズ/枚数）: 追加せずトースト表示
  - 送信失敗: 入力内容とプレビューは保持、送信ボタン再活性化、エラー文言表示（再試行可）
- ガード
  - 重複ファイル名+サイズの同一選択は重複追加しない
  - 処理中はファイル入力を `disabled`
  - クリップボードの画像貼付にも対応（同じバリデーションを適用）

# テスト観点（Tests）
1. 画像選択後に**自動送信されず**、プレビューが入力エリアに表示される
2. プレビューが表示された状態で送信ボタンが活性化する（テキスト未入力でも可）
3. × ボタンで個別プレビューが削除でき、最後の1枚を削除すると送信は無効化される（テキスト未入力時） 
4. 成功時、タイムラインに**1つのユーザーメッセージ**としてテキストと画像が同時に表示され、入力とプレビューがクリアされる
5. サポート外形式/サイズ超過/枚数超過は追加されず、エラートーストが表示される
6. 送信失敗時、入力内容とプレビューは残り、再送可能である
7. クリップボード貼付で画像がプレビューに追加される
8. 送信中は送信ボタンがスピナー表示になり、二重送信されない

# 制約（Constraints）
- 新規依存は禁止（既存 Uploader/Toast/Tooltip/状態管理を再利用）
- DOM 構造は既存チャットカード内に収める（外側コンテナは変更不可）
- スタイルは Tailwind ユーティリティ優先
- 型安全（`any` 禁止）
  - 例: `type ChatImage = { id: string; file: File; url: string; size: number; type: "image/png"|"image/jpeg"|"image/webp"; }`

# Acceptance Criteria (AC)
1. 画像選択後に即時送信されないこと（プレビュー表示に留まる）
2. 送信操作時にテキストと画像が**同一メッセージ**として送信されること
3. バリデーション（形式/サイズ/枚数）が機能し、NG時は追加されないこと
4. 成功後に入力欄・プレビューがクリアされること
5. 異常時は内容保持＋明確なエラー通知＋再送可能であること


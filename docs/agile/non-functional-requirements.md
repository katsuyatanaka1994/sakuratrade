# 非機能要件シート

- 作成者（Codex）:
- レビュアー（人間）:
- 最終更新日:
- 次回レビュー期限:
- バージョン:
- 適用環境: production / staging / development

## 1. 目的・スコープ
この文書は、[プロダクト名] の性能・可用性・運用性など非機能要件 (NFR) を定義し、対象範囲と除外範囲を明確にする。

## 2. KGI / SLO 概要
| 指標 | 目標値 | 測定期間 | 備考 |
| --- | --- | --- | --- |
| SLA | 99.9% | 月次 | 稼働率 |
| API成功率 | >= 99.5% | 月次 | エンドポイントの平均 |
| P95 レイテンシ | < 500ms | 月次 | 主要API |
|  |  |  |  |

## 3. 体制と責任
| 役割 | 担当者 | 連絡先 | 備考 |
| --- | --- | --- | --- |
| SREリード |  |  |  |
| 運用担当 (オンコール) |  |  |  |
| プロダクトオーナー |  |  |  |
| レビュー頻度 |  |  | 四半期 / 半期 |

## 4. 要件
### 4.1 可用性
| 優先度 | 要件 | 受入基準 | 検証タイミング |
| --- | --- | --- | --- |
| MUST | サービス可用性 99.9%（月次）を目標とする | 監視ダッシュボードで可用性が計測され月次レポート化 | 月次レビュー |
| SHOULD | リージョン冗長化を検討 | DR計画がドキュメント化 | 半期レビュー |
|  |  |  |  |

### 4.2 性能（レイテンシ / スループット）
| 優先度 | 要件 | 受入基準 | 検証タイミング |
| --- | --- | --- | --- |
| MUST | 平均APIレスポンス < 200ms、P95 < 500ms | 負荷テストレポートで基準を満たす | リリース前 |
| MUST | 想定ピーク QPS = X を満たす設計 | 負荷試験でピーク時の処理が破綻しない | 半期レビュー |
| SHOULD | バックエンド処理は非同期キューで平滑化 | キュー監視で滞留がない | 月次レビュー |
|  |  |  |  |

### 4.3 スケーラビリティ
| 優先度 | 要件 | 受入基準 | 検証タイミング |
| --- | --- | --- | --- |
| MUST | オートスケール閾値（CPU, レイテンシ）を定義する | スケールアウト/インが自動で発動したログがある | 四半期レビュー |
| SHOULD | インフラ構成コード (IaC) を整備する | Terraform 等で構成管理 | リリース前 |
|  |  |  |  |

### 4.4 バックアップ & リカバリ
| 優先度 | 要件 | 受入基準 | 検証タイミング |
| --- | --- | --- | --- |
| MUST | DBフルバックアップは日次、増分は1時間毎。RPO = 1時間、RTO = 2時間 | リストア手順でテスト復旧が成功 | 半期レビュー |
| SHOULD | オブジェクトストレージはバージョニングを有効化 | 削除事故時の復旧手順が文書化 | 年次 |
|  |  |  |  |

### 4.5 ロギング・監視（Observability）
| 優先度 | 要件 | 受入基準 | 検証タイミング |
| --- | --- | --- | --- |
| MUST | レスポンス時間, エラー率, CPU, メモリのメトリクス収集とダッシュボード化 | ダッシュボードが閲覧可能で主要アラート設定済 | 月次レビュー |
| SHOULD | 分散トレーシング (OpenTelemetry 等) を導入 | 主要トランザクションのTraceが取得できる | 半期レビュー |
|  |  |  |  |

### 4.6 デプロイ・CI/CD
| 優先度 | 要件 | 受入基準 | 検証タイミング |
| --- | --- | --- | --- |
| MUST | Canary / Blue-Green 等のローリング方式を採用 | デプロイ手順にロールバック手順が含まれる | リリース前 |
| SHOULD | 本番デプロイ前にステージングで自動テストを通過させる | CI結果で合格を確認 | 毎デプロイ |
|  |  |  |  |

### 4.7 セキュリティ整合
| 優先度 | 要件 | 受入基準 | 検証タイミング |
| --- | --- | --- | --- |
| MUST | 非機能要件はセキュリティ要件と整合（参照: `docs/agile/security-considerations.md`） | 変更時に両ドキュメント更新をPRルール化 | 毎PR |
| SHOULD | セキュリティレビューと性能テストの結果を相互に反映 | レビュー記録にリンク掲載 | 四半期レビュー |
|  |  |  |  |

### 4.8 可観測性指標（SLO詳細）
| サービス | 指標 | SLO | SLI 取得方法 | アラート閾値 |
| --- | --- | --- | --- | --- |
| API | 成功率 | 99.5% | Apm/Logs | 連続5分でSLO-1% |
| API | P95 レイテンシ | 500ms | Apm/Logs | 連続5分で>500ms |
|  |  |  |  |  |

## 5. テスト計画
| テスト種別 | スコープ | ツール / 自動化 | 実施タイミング | エビデンス |
| --- | --- | --- | --- | --- |
| 負荷テスト | 主要APIパス | k6 / Locust | リリース前 | レポートURL |
| レイテンシ計測 | API Gateway | CloudWatch / Datadog | 常時 | ダッシュボード |
| 回帰性能試験 | バッチ処理 | Jenkins pipeline | 月次 | レポート |
|  |  |  |  |  |

## 6. モニタリング & アラート
- 主要アラート一覧:
  - 5xx エラー率 > 2% (5分連続) → PagerDuty
  - 認証失敗率 > 5% → Slack #ops
  - キュー滞留 > N件 → On-call
- オンコール対応時間: 24/7 / 9-18JST 等
- エスカレーション: レベル1 (On-call) → レベル2 (SREリード) → レベル3 (エンジニアリングマネージャ)

## 7. 運用手順
- バックアップ復旧手順: (Runbookリンク)
- 定期メンテナンス窓口と告知ルール: (例: メンテ2週間前に顧客告知)
- 運用Runbook所在地: (ドキュメントリンク)

## 8. 依存関係
| システム / サービス | 依存内容 | 可用性 | SLA | 備考 |
| --- | --- | --- | --- | --- |
| 外部決済API | 支払い処理 | 99.5% | 99.5% | 事前通知48h |
| メール送信サービス | 通知配信 | 99.9% | 99.9% | バックアップ手段要検討 |
|  |  |  |  |  |

## 9. 関連ドキュメント
- セキュリティ要件: `docs/agile/security-considerations.md`
- テスト計画: `docs/agile/integration-test-specification.md`
- CI/CD 手順: `docs/agile/ci-specification.md`
- API仕様: `docs/agile/api-specification.md`

## 10. 変更履歴
- YYYY-MM-DD: 初版作成 (PR # / 担当者)
- YYYY-MM-DD:

